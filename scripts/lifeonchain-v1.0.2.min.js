const SPEED=[{name:"blistering",value:10},{name:"rapid",value:30},{name:"swift",value:50},{name:"moderate",value:60},{name:"leisurely",value:80},{name:"sluggish",value:100}];const COLORS=[{name:"rainbow",value:[]},{name:"hacker green",value:["#000000","#4dff4d"]},{name:"matrix green",value:["#00ff00","#0f701e"]},{name:"acid burn",value:["#00ffff","#04af6d"]},{name:"cyberpunk",value:["#00ff00","#ff00ff"]},{name:"terminator red",value:["#c0c0c0","#ff2400"]},{name:"hacker black",value:["#1c1c1c","#000000"]},{name:"circuit board",value:["#00ff7f","#7f00ff"]},{name:"cyber yellow",value:["#000000","#f9dc24"]},{name:"neon pink",value:["#00ff00","#ff0090"]},{name:"hackerman blue",value:["#ffffff","#1e90ff"]},{name:"lime green",value:["#000000","#00ff7f"]},{name:"cyber purple",value:["#00ffff","#8a2be2"]},{name:"ghost in the shell",value:["#1c1c1c","#ff6a00"]},{name:"cylon red",value:["#00ff00","#c21e56"]},{name:"darknet red",value:["#00ff00","#a62b2b"]}];const MODES=[{name:"yinyang",value:[]},{name:"floating diamond",value:[5,1,3,7]},{name:"techno scripspy",value:[1,6,4,8]},{name:"glitzy globs",value:[0,7,5,8]},{name:"rocketry",value:[0,0,2,2]},{name:"flicker box",value:[8,8,1,1]},{name:"lazer disk",value:[7,8,2,5]},{name:"shattered glass",value:[2,6,0,2]},{name:"mayan bricks",value:[2,4,1,2]},{name:"honey comb",value:[0,7,4,6]},{name:"original",value:[2,3,3,3]}];let started=false;function start(){if(started)return;started=true;let e=8;let t=document.body;let i=window.innerWidth;let l=window.innerHeight;let s=i/e;let a=l/e;t.style.height=l+"px";t.style.width=i+"px";let n=cyrb128(tokenID.toString());let r=mulberry32(n[0]);let o=new ConwaySimulator(a,s,e,SPEED[speedIndex].value,r);t.prepend(o.canvas);if(colorIndex===0){o.setRainbowScheme()}else{o.setPixelColors(...COLORS[colorIndex].value)}if(modeIndex===0){o.setYinYangMode()}else{o.setRules(...MODES[modeIndex].value)}o.start()}function tryToStart(){if(window.innerWidth==0||window.innerHeight==0||document.body==null){setTimeout((()=>{tryToStart()}),1)}else{start()}}class ConwaySimulator{constructor(e,t,i,l,s){this.rows=e;this.cols=t;this.pixelSize=i;this.interRoundDelay=l;this.mouseIsDown=false;this.paused=false;this.intervalId=null;this.grid=[];for(let i=0;i<e;i++){this.grid.push([]);for(let e=0;e<t;e++){let e=s()<.12;this.grid[i].push(new ConwayPixel(e))}}for(let e=0;e<this.rows;e++){for(let t=0;t<this.cols;t++){this.grid[e][t].neighbors=this.getNeighbors(e,t)}}let a=this.pixelSize*this.cols;let n=this.pixelSize*this.rows;this.canvas=document.createElement("canvas");this.canvas.width=a;this.canvas.height=n;this.canvasCtx=this.canvas.getContext("2d",{alpha:false});this.registerMouseListeners()}start(){if(this.intervalId){return}this.intervalId=setInterval((()=>{this.advanceRound();this.repaint()}),this.interRoundDelay)}getNeighbors(e,t){let i=[];for(let l=e-1;l<=e+1;l++){for(let s=t-1;s<=t+1;s++){if(l===e&&s===t)continue;if(this.grid[l]&&this.grid[l][s]){i.push(this.grid[l][s])}}}return i}advanceRound(){if(this.mouseIsDown)return;for(let e=0;e<this.rows;e++){for(let t=0;t<this.cols;t++){this.grid[e][t].prepareUpdate()}}for(let e=0;e<this.rows;e++){for(let t=0;t<this.cols;t++){this.grid[e][t].update()}}}repaint(e=false){if(this.mouseIsDown&&!e)return;let t={};for(let i=0;i<this.rows;i++){for(let l=0;l<this.cols;l++){let s=this.grid[i][l];if(!e&&!s.forceRepaint&&s.alive===s.previousState){continue}let a=s.alive?s.lifeStyle:s.deathStyle;if(t[a]===undefined){t[a]=[]}t[a].push([i,l]);s.forceRepaint=false}}for(let e in t){this.canvasCtx.fillStyle=e;for(let[i,l]of t[e]){this.canvasCtx.fillRect(l*this.pixelSize,i*this.pixelSize,this.pixelSize,this.pixelSize)}}}paintPixel(e,t){this.grid[e][t].setPaintStyles(this.canvasCtx);this.canvasCtx.fillRect(t*this.pixelSize,e*this.pixelSize,this.pixelSize,this.pixelSize)}setPixelColors(e,t){this.grid.forEach((i=>{i.forEach((i=>{i.lifeStyle=e;i.deathStyle=t;i.forceRepaint=true}))}))}setRainbowScheme(){let e=this.grid.length;let t=this.grid[0].length;let i=Math.sqrt(this.rows*this.rows+this.cols*this.cols);let l=360/i;for(let e=0;e<this.rows;e++){for(let t=0;t<this.cols;t++){let i=Math.floor(Math.sqrt(e*e+t*t)*l);let s=this.grid[e][t];s.lifeStyle=`hsl(${i}, 100%, 60%)`;s.deathStyle=`#000000`;s.forceRepaint=true}}}setRules(e,t,i,l){this.grid.forEach((s=>{s.forEach((s=>{s.underpopulation=e;s.overpopulation=t;s.reproductionMin=i;s.reproductionMax=l}))}))}setYinYangMode(){for(let e=0;e<this.rows;e++){for(let t=0;t<this.cols/2;t++){let i=this.grid[e][t].lifeStyle;this.grid[e][t].lifeStyle=this.grid[e][t].deathStyle;this.grid[e][t].deathStyle=i}}this.repaint(true)}registerMouseListeners(){bindMultipleEventListener(this.canvas,["mousemove","touchmove"],(e=>{e.preventDefault();if(this.mouseIsDown){let t,i;if(e.touches){let l=e.target.getBoundingClientRect();t=Math.floor((e.touches[0].pageX-l.left)/this.pixelSize);i=Math.floor((e.touches[0].pageY-l.top)/this.pixelSize)}else{t=Math.floor(e.offsetX/this.pixelSize);i=Math.floor(e.offsetY/this.pixelSize)}this.grid[i][t].handleClick();this.paintPixel(i,t)}}));bindMultipleEventListener(this.canvas,["mousedown","touchstart"],(e=>{e.preventDefault();let t=e.target.getBoundingClientRect();let i,l;if(e.touches){let t=e.target.getBoundingClientRect();i=Math.floor((e.touches[0].pageX-t.left)/this.pixelSize);l=Math.floor((e.touches[0].pageY-t.top)/this.pixelSize)}else{i=Math.floor(e.offsetX/this.pixelSize);l=Math.floor(e.offsetY/this.pixelSize)}this.grid[l][i].handleClick();this.paintPixel(l,i);this.mouseIsDown=true}));bindMultipleEventListener(this.canvas,["mouseup","touchend"],(e=>{e.preventDefault();this.mouseIsDown=false}))}}class ConwayPixel{constructor(e){this.alive=e;this.lifeStyle="#39ff14";this.deathStyle="#000000";this.underpopulation=2;this.overpopulation=3;this.reproductionMin=3;this.reproductionMax=3;this.neighbors=[];this.nextState=null;this.previousState=null;this.forceRepaint=true;if(this.reproductionMax<this.reproductionMin){this.reproductionMin=this.reproductionMax}}prepareUpdate(){let e=0;let t=this.alive;for(let t of this.neighbors){if(t.alive&&t!==this)e++}if(t&&e<this.underpopulation){t=false}else if(t&&e>this.overpopulation){t=false}else if(!t&&e>=this.reproductionMin&&e<=this.reproductionMax){t=true}this.nextState=t}update(){this.previousState=this.alive;this.alive=this.nextState;this.nextState=null}handleClick(){this.alive=true}setPaintStyles(e){e.fillStyle=this.alive?this.lifeStyle:this.deathStyle}}function bindMultipleEventListener(e,t,i){t.forEach((t=>{e.addEventListener(t,i)}))}function cyrb128(e){let t=1779033703,i=3144134277,l=1013904242,s=2773480762;for(let a=0,n;a<e.length;a++){n=e.charCodeAt(a);t=i^Math.imul(t^n,597399067);i=l^Math.imul(i^n,2869860233);l=s^Math.imul(l^n,951274213);s=t^Math.imul(s^n,2716044179)}t=Math.imul(l^t>>>18,597399067);i=Math.imul(s^i>>>22,2869860233);l=Math.imul(t^l>>>17,951274213);s=Math.imul(i^s>>>19,2716044179);return[(t^i^l^s)>>>0,(i^t)>>>0,(l^t)>>>0,(s^t)>>>0]}function mulberry32(e){return function(){var t=e+=1831565813;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}tryToStart();window.addEventListener("DOMContentLoaded",(()=>{tryToStart()}));